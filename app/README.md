# ü§ñ Telegram Bot - –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ú–æ–¥—É–ª—å–Ω—ã–π Telegram –±–æ—Ç —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∫–∞–ø—á–∏, –∞–Ω—Ç–∏—Å–ø–∞–º–∞ –∏ AI —á–∞—Ç–∞ –Ω–∞ –±–∞–∑–µ TypeScript + GramIO + Gemini API.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- **üîê –ö–∞–ø—á–∞** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏
- **üõ°Ô∏è –ê–Ω—Ç–∏—Å–ø–∞–º** - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–µ—Ä–≤—ã—Ö 5 —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ AI + –±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞
- **ü§ñ AI –ß–∞—Ç** - –û–±—â–µ–Ω–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ Google Gemini 2.5
- **üåê –í–µ–±-–ø–∞–Ω–µ–ª—å** - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram WebApp

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
cd app
npm install

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Å–º. docs/DATABASE_SETUP.md)
# PostgreSQL + Redis –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

# 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å BOT_TOKEN, DATABASE_URL, REDIS_URL
# AI_API_KEY —Ç–µ–ø–µ—Ä—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

# 4. –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
npm run db:migrate

# 5. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
npm run build
npm start
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### üìñ –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **[ARCHITECTURE_OVERVIEW.md](docs/ARCHITECTURE_OVERVIEW.md)** - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- **[BOT_LOGIC_REFERENCE.md](docs/BOT_LOGIC_REFERENCE.md)** - –ö—Ä–∞—Ç–∫–∏–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ª–æ–≥–∏–∫–∏ –±–æ—Ç–∞
- **[ARCHITECTURE_DIAGRAM.md](docs/ARCHITECTURE_DIAGRAM.md)** - –î–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- **[DATABASE_SETUP.md](docs/DATABASE_SETUP.md)** - üóÑÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
- **[docs/TESTING_GUIDE.md](docs/TESTING_GUIDE.md)** - üß™ –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **Dependency Injection** - –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–Ω–∂–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- **Service Lifecycle** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —á–µ—Ä–µ–∑ IService –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É —Ñ—É–Ω–∫—Ü–∏—é
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –æ—á–µ—Ä–µ–¥–∏, throttling

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
app/src/
‚îú‚îÄ‚îÄ core/                    # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ Container.ts         # DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ Application.ts       # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ services/                # –ë–∏–∑–Ω–µ—Å-—Å–µ—Ä–≤–∏—Å—ã (–º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
‚îÇ   ‚îú‚îÄ‚îÄ TelegramBot/         # –ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–∏—Å –±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ DatabaseService/     # üóÑÔ∏è PostgreSQL + Drizzle ORM
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ RedisService/        # üîÑ Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ CaptchaService/      # –°–µ—Ä–≤–∏—Å –∫–∞–ø—á–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ AntiSpamService/     # –°–µ—Ä–≤–∏—Å –∞–Ω—Ç–∏—Å–ø–∞–º–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ AIChatService/       # –°–µ—Ä–≤–∏—Å AI —á–∞—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ CacheService/        # –°–µ—Ä–≤–∏—Å –∫—ç—à–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ AI/                  # –°–µ—Ä–≤–∏—Å AI API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ ApiServerService/    # API-—Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îî‚îÄ‚îÄ weather/             # –°–µ—Ä–≤–∏—Å –ø–æ–≥–æ–¥—ã
‚îÇ       ‚îî‚îÄ‚îÄ WeatherService.ts
‚îú‚îÄ‚îÄ db/                      # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ schema.ts            # Drizzle ORM —Å—Ö–µ–º–∞
‚îú‚îÄ‚îÄ helpers/                 # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ repository/              # –°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ web/                     # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ __tests__/               # üß™ –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ unit/services/       # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ setup.ts             # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ README.md            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
‚îú‚îÄ‚îÄ app.ts                   # –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ index.ts                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ config.ts                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

### üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–æ–¥—É–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**‚úÖ –ß—Ç–æ –¥–∞–µ—Ç –Ω–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤:**
- **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –ø–∞–ø–∫–µ
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å —É—Ç–∏–ª–∏—Ç—ã, —Ç–∏–ø—ã –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Ä—è–¥–æ–º —Å —Å–µ—Ä–≤–∏—Å–æ–º
- **–£–¥–æ–±—Å—Ç–≤–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞** - –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- **–ß–∏—Å—Ç–æ—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** - –∫–æ—Ä–µ–Ω—å `services/` –±–æ–ª—å—à–µ –Ω–µ –∑–∞—Ö–ª–∞–º–ª–µ–Ω —Ñ–∞–π–ª–∞–º–∏

**üîß –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:**
```
services/TelegramBot/
‚îú‚îÄ‚îÄ index.ts                 # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å
‚îú‚îÄ‚îÄ types.ts                 # –¢–∏–ø—ã —Å–µ—Ä–≤–∏—Å–∞
‚îú‚îÄ‚îÄ utils.ts                 # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ handlers/                # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ messageHandler.ts
‚îÇ   ‚îî‚îÄ‚îÄ callbackHandler.ts
‚îî‚îÄ‚îÄ middleware/              # –ú–∏–¥–¥–ª–≤–∞—Ä—ã
    ‚îî‚îÄ‚îÄ authMiddleware.ts
```

## üéÆ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### üîê –ö–∞–ø—á–∞
```
–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ—Ä–∞ (5+3=?) ‚Üí InlineKeyboard ‚Üí
60 —Å–µ–∫ —Ç–∞–π–º–∞—É—Ç ‚Üí –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ‚úÖ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: ‚ùå –±–∞–Ω 1 —á–∞—Å
```

### üõ°Ô∏è –ê–Ω—Ç–∏—Å–ø–∞–º
```
–ü–µ—Ä–≤—ã–µ 5 —Å–æ–æ–±—â–µ–Ω–∏–π ‚Üí –ë–∞–∑–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã ‚Üí AI –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí
–°–ø–∞–º: ‚ùå —É–¥–∞–ª–µ–Ω–∏–µ + –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ | –ù–µ —Å–ø–∞–º: ‚úÖ –ø—Ä–æ–ø—É—Å–∫
```

### ü§ñ AI –ß–∞—Ç
```
@bot –∏–ª–∏ "—ç–π –±–æ—Ç" ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ ‚Üí –û—á–µ—Ä–µ–¥—å ‚Üí Gemini API ‚Üí
Throttling 3 —Å–µ–∫ ‚Üí –û—Ç–≤–µ—Ç –≤ —á–∞—Ç + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ë–î –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

**üéØ PostgreSQL + Redis** - –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, AI –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
- **Redis** - –≤—ã—Å–æ–∫–æ—Å–∫–æ—Ä–æ—Å—Ç–Ω–æ–π –∫—ç—à (–∫–∞–ø—á–∞, –∞–Ω—Ç–∏—Å–ø–∞–º, –ª–∏–º–∏—Ç—ã)

### –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö:
```sql
-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (PostgreSQL)
users          # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
chats          # –ß–∞—Ç—ã –∏ –∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
ai_contexts    # AI –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã —Å JSONB
chat_members   # –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å
bot_stats      # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
event_logs     # –õ–æ–≥ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

-- –ö—ç—à (Redis) —Å TTL
captcha:user:* # –ö–∞–ø—á–∞ (5 –º–∏–Ω)
antispam:user:* # –ê–Ω—Ç–∏—Å–ø–∞–º (24 —á–∞—Å–∞)
ai:limit:*     # AI –ª–∏–º–∏—Ç—ã (–¥–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è)
user:*         # –ö—ç—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (1 —á–∞—Å)
```

### –ö–æ–º–∞–Ω–¥—ã –ë–î:
```bash
npm run db:generate  # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
npm run db:migrate   # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
npm run db:studio    # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ë–î
npm run db:push      # Push —Å—Ö–µ–º—ã (dev)
```

**üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**: [DATABASE_SETUP.md](docs/DATABASE_SETUP.md)

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ
BOT_TOKEN=your_telegram_bot_token

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
DATABASE_URL=postgresql://username:password@localhost:5432/tgbot

# Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
REDIS_URL=redis://localhost:6379/0

# –í–µ–±-—Å–µ—Ä–≤–µ—Ä
PORT=3000

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
ADMIN_USERNAME=@admin_username

# –ó–∞–º–µ—Ç–∫–∞: AI_API_KEY —Ç–µ–ø–µ—Ä—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
# DEFAULT_CHAT_ID –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º—É–ª—å—Ç–∏—á–∞—Ç–æ–≤–æ–º –±–æ—Ç–µ
```

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –±–æ—Ç–∞
```typescript
CAPTCHA_TIMEOUT = 60000        # 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ –∫–∞–ø—á–∏
MAX_MESSAGES_TO_CHECK = 5      # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—ã–µ 5 —Å–æ–æ–±—â–µ–Ω–∏–π
DAILY_LIMIT = 1500             # –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç AI –∑–∞–ø—Ä–æ—Å–æ–≤
MAX_QUEUE_SIZE = 8             # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ AI
THROTTLE_DELAY = 3000          # 3 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É AI –∑–∞–ø—Ä–æ—Å–∞–º–∏
```

## üåê API –∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### REST API
```typescript
GET / api / health // –°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
GET / api / health / database // –°—Ç–∞—Ç—É—Å PostgreSQL
GET / api / health / redis // –°—Ç–∞—Ç—É—Å Redis
GET / api / config // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞ (—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å)
POST / api / config // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
GET / api / stats // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
GET / api / stats / database // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î
GET / admin // Telegram WebApp –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```

### Telegram WebApp
- üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–ø—á–∏ (–≤–∫–ª/–≤—ã–∫–ª, —Ç–∞–π–º–∞—É—Ç)
- üõ°Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω—Ç–∏—Å–ø–∞–º–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)
- ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ AI —á–∞—Ç–∞ (–¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç, –≤–∫–ª/–≤—ã–∫–ª)
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º —Å–µ—Ä–≤–∏—Å–∞–º
- üóÑÔ∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**URL**: `http://localhost:3000/admin`

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ö–æ–º–∞–Ω–¥—ã NPM
```bash
npm run build       # –°–±–æ—Ä–∫–∞ TypeScript
npm start           # –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
npm run dev         # –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å watch mode
npm run prod        # –ü—Ä–æ–¥–∞–∫—à–Ω —Å–±–æ—Ä–∫–∞ + –∑–∞–ø—É—Å–∫

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
npm run db:generate # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
npm run db:migrate  # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
npm run db:studio   # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ë–î
npm run db:push     # Push —Å—Ö–µ–º—ã (dev only)

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
npm test            # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
npm run test:watch  # –¢–µ—Å—Ç—ã –≤ —Ä–µ–∂–∏–º–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
npm run test:coverage # –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
npm run test:ci     # –¢–µ—Å—Ç—ã –¥–ª—è CI/CD

# –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
npm run lint        # –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞
npm run lint:fix    # –ê–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
1. –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π `IService`
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `Application.ts`
3. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ DI

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –±–æ—Ç–∞
```typescript
// –í TelegramBotService.setupEventHandlers()
this.bot.on("new_event", (context) => {
  this.handleNewEvent(context)
})
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
```
[05.06.2025 20:24:45][App][INFO]: ‚úÖ Telegram bot started: @test_ai_group_bot
[05.06.2025 20:24:45][App][INFO]: ‚úÖ Database service started - connection successful
[05.06.2025 20:24:45][App][INFO]: ‚úÖ Redis service started successfully
[05.06.2025 20:24:45][App][INFO]: üåç Environment: development
[05.06.2025 20:24:45][App][INFO]: ü§ñ Bot mode: enabled
[05.06.2025 20:24:45][App][INFO]: üéâ Application is running!
```

### Health Checks
- **isHealthy()** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- **getStats()** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
- **/api/health** - –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **/api/health/database** - PostgreSQL —Å—Ç–∞—Ç—É—Å + –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- **/api/health/redis** - Redis —Å—Ç–∞—Ç—É—Å + –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **PostgreSQL**: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤, —Ä–∞–∑–º–µ—Ä –ë–î
- **Redis**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏, hit ratio, –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥
- **Telegram Bot**: rate limits, –æ—à–∏–±–∫–∏ API, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

## üê≥ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Docker Compose —Å –ë–î
```yaml
version: "3.8"
services:
  bot:
    build: .
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - DATABASE_URL=postgresql://postgres:password@postgres:5432/tgbot
      - REDIS_URL=redis://redis:6379/0
      - AI_API_KEY=${AI_API_KEY}
    ports:
      - "3000:3000"
    depends_on:
      - postgres
      - redis

  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: tgbot
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

## üìà –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **TypeScript** - —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JavaScript
- **Node.js** - —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- **GramIO** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è Telegram Bot API –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- **Google Gemini 2.5** - AI –¥–ª—è —á–∞—Ç–∞ –∏ –∞–Ω—Ç–∏—Å–ø–∞–º–∞
- **Fastify** - –±—ã—Å—Ç—Ä—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL 15+** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å JSONB
- **Drizzle ORM** - type-safe ORM –¥–ª—è PostgreSQL
- **Redis 7+** - –≤—ã—Å–æ–∫–æ—Å–∫–æ—Ä–æ—Å—Ç–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Jest** - üß™ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

## üéØ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **Connection pooling** (20 –¥–ª—è PostgreSQL, 10 –¥–ª—è Redis)
- **–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** —á–µ—Ä–µ–∑ Drizzle ORM
- **JSONB –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è AI –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
- **Redis TTL** –¥–ª—è –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞
- **Graceful shutdown** –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### Benchmarks:
- **–ö–∞–ø—á–∞**: < 200ms –≥–µ–Ω–µ—Ä–∞—Ü–∏—è + –æ—Ç–ø—Ä–∞–≤–∫–∞
- **–ê–Ω—Ç–∏—Å–ø–∞–º**: < 500ms –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ AI
- **AI —á–∞—Ç**: < 3s –æ—Ç–≤–µ—Ç (—Å throttling)
- **Database**: < 10ms —Ç–∏–ø–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- **Redis**: < 1ms –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**üöÄ –≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –¥–ª—è Telegram –±–æ—Ç–æ–≤ –ª—é–±–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∞!**

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. —Ñ–∞–π–ª [LICENSE](LICENSE)

---

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (`git checkout -b feature/amazing-feature`)
3. Commit –∏–∑–º–µ–Ω–µ–Ω–∏–π (`git commit -m 'Add some amazing feature'`)
4. Push –≤ –≤–µ—Ç–∫—É (`git push origin feature/amazing-feature`)
5. –°–æ–∑–¥–∞—Ç—å Pull Request

---

*–ü—Ä–æ–µ–∫—Ç –æ–±–Ω–æ–≤–ª–µ–Ω: 05.06.2025*
*–í–µ—Ä—Å–∏—è: 2.0*
*–°—Ç–∞—Ç—É—Å: ‚úÖ –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ç–æ—Ç–∏–ø*
