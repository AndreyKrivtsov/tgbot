# üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Telegram Bot

## üìã –û–±–∑–æ—Ä

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 3 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞–º–∏, –∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ò–ò –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏.

---

## üìä –¢–∞–±–ª–∏—Ü—ã

### 1. **chats** - –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–∞—Ö

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è |
|------|-----|----------|-------------|
| `id` | bigint | Telegram chat ID | PRIMARY KEY |
| `type` | varchar(50) | –¢–∏–ø —á–∞—Ç–∞ (private, group, supergroup) | NOT NULL |
| `title` | varchar(255) | –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞ | NULL |
| `active` | boolean | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ —á–∞—Ç | DEFAULT true |
| `created_at` | timestamp | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ | DEFAULT NOW() |
| `updated_at` | timestamp | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | DEFAULT NOW() |

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_chats_type` –Ω–∞ `type`
- `idx_chats_active` –Ω–∞ `active`

---

### 2. **chat_configs** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ò–ò –¥–ª—è —á–∞—Ç–æ–≤

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è |
|------|-----|----------|-------------|
| `chat_id` | bigint | ID —á–∞—Ç–∞ (—Å—Å—ã–ª–∫–∞ –Ω–∞ chats.id) | PRIMARY KEY, FOREIGN KEY |
| `gemini_api_key` | varchar(512) | API –∫–ª—é—á –¥–ª—è Gemini | NULL |
| `system_prompt` | jsonb | –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ | NULL |
| `ai_enabled` | boolean | –í–∫–ª—é—á–µ–Ω –ª–∏ –ò–ò –≤ —á–∞—Ç–µ | DEFAULT true |
| `throttle_delay` | integer | –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–º—Å) | DEFAULT 3000 |
| `created_at` | timestamp | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ | DEFAULT NOW() |
| `updated_at` | timestamp | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | DEFAULT NOW() |

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ system_prompt JSON:**
```json
{
  "–æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞": "string (optional)",
  "—Ö–∞—Ä–∞–∫—Ç–µ—Ä": "string (optional)", 
  "–ø–æ–ª": "string (optional)"
}
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_chat_configs_ai_enabled` –Ω–∞ `ai_enabled`

---

### 3. **group_admins** - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≥—Ä—É–ø–ø

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è |
|------|-----|----------|-------------|
| `group_id` | bigint | ID –≥—Ä—É–ø–ø—ã (—Å—Å—ã–ª–∫–∞ –Ω–∞ chats.id) | NOT NULL, FOREIGN KEY |
| `user_id` | bigint | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | NOT NULL |
| `created_at` | timestamp | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ | DEFAULT NOW() |

**–ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á:** `(group_id, user_id)`

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_group_admins_group` –Ω–∞ `group_id`
- `idx_group_admins_user` –Ω–∞ `user_id`

---

## üîó –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–≤—è–∑–∏:
1. **chats.id** ‚Üî **chat_configs.chat_id** (–æ–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É)
2. **chats.id** ‚Üî **group_admins.group_id** (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º)

### –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ —Å–≤—è–∑–∏:
- `chat_configs(chat_id)` ‚Üí `chats(id)` ON DELETE CASCADE
- `group_admins(group_id)` ‚Üí `chats(id)` ON DELETE CASCADE

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### AI –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- –ö–∞–∂–¥—ã–π —á–∞—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π **API –∫–ª—é—á Gemini**
- **–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç** –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ —Å –ø–æ–ª—è–º–∏: "–æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞", "—Ö–∞—Ä–∞–∫—Ç–µ—Ä", "–ø–æ–ª"
- **–ó–∞–¥–µ—Ä–∂–∫–∏** –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ò–ò –≤–∫–ª—é—á–µ–Ω –≤–æ –≤—Å–µ—Ö —á–∞—Ç–∞—Ö
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ò–ò —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —á–∞—Ç–µ

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≥—Ä—É–ø–ø** –º–æ–≥—É—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–∞—Ç–∞
- **–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏** –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- **CASCADE —É–¥–∞–ª–µ–Ω–∏–µ** –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —á–∞—Ç–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–ò–Ω–¥–µ–∫—Å—ã** –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **JSONB** –ø–æ–ª—è –¥–ª—è –≥–∏–±–∫–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
- **–ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á** –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** –º–µ–∂–¥—É –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

### –õ–æ–≥–∏–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞:
- JSON –ø–æ–ª—è –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –µ–¥–∏–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- –ü—Ä–∏–º–µ—Ä –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è: "–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞: {–ø—Ä–∞–≤–∏–ª–∞}. –•–∞—Ä–∞–∫—Ç–µ—Ä: {—Ö–∞—Ä–∞–∫—Ç–µ—Ä}. –ü–æ–ª: {–ø–æ–ª}."
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ AI API –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 2024-12-19*
*–í–µ—Ä—Å–∏—è —Å—Ö–µ–º—ã: 3.0 (—Å —Ä–∞–∑–¥–µ–ª—å–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏)*
