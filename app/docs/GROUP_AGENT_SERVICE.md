# ü§ñ GroupAgentService

## üìã –û–±–∑–æ—Ä

**GroupAgentService** ‚Äî AI-–∞–≥–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤ –±–∞—Ç—á–∞–º–∏, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è –æ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã. –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –¥—Ä—É–≥–∏–º–∏ AI-—Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –±–µ—Ä–µ—Ç –Ω–∞ —Å–µ–±—è –∏—Ö –∑–∞–¥–∞—á–∏.

**–°—Ç–∞—Ç—É—Å:** MVP  
**–í–µ—Ä—Å–∏—è:** 1.0.0

---

## üéØ –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏

- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º –≤ –≥—Ä—É–ø–ø–∞—Ö Telegram
- –≠–∫–æ–Ω–æ–º–∏—è –ª–∏–º–∏—Ç–æ–≤ AI –∑–∞ —Å—á–µ—Ç –±–∞—Ç—á–µ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è –∏ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ –∂—ë—Å—Ç–∫–æ –∑–∞—à–∏—Ç—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç–≤–æ–ª—é—Ü–∏–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ —Å–µ—Ä–≤–∏—Å–∞

### –ë–∏–∑–Ω–µ—Å-–∑–∞–¥–∞—á–∏

- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π –∏ –≤—ã–ø—É—Å–∫ –º–æ–¥–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —á–∞—Ç–∞ –∑–∞ —Å—á–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏—Ö, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- **–°–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.** Domain –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç—ã.
- **Event-Driven –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è.** –í—Å—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏–¥–µ—Ç —á–µ—Ä–µ–∑ `EventBus`.
- **Modularity & SRP.** –£ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å–≤–æ—è –∑–æ–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: –±—É—Ñ–µ—Ä, –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π.
- **Graceful degradation.** –û—à–∏–±–∫–∏ AI –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —á–∞—Ç–æ–≤ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
GroupAgentService/
‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îú‚îÄ‚îÄ ActionsBuilder.ts
‚îÇ   ‚îú‚îÄ‚îÄ BatchProcessor.ts
‚îÇ   ‚îú‚îÄ‚îÄ DecisionOrchestrator.ts
‚îÇ   ‚îî‚îÄ‚îÄ MessageBuffer.ts
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îú‚îÄ‚îÄ MessageFormatter.ts
‚îÇ   ‚îú‚îÄ‚îÄ ModerationPolicy.ts
‚îÇ   ‚îú‚îÄ‚îÄ ResponsePolicy.ts
‚îÇ   ‚îî‚îÄ‚îÄ types.ts
‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ adapters/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatRepositoryAdapter.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EventBusAdapter.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GeminiAdapter.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RedisStateStoreAdapter.ts
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ defaultInstructions.ts
‚îÇ   ‚îî‚îÄ‚îÄ prompt/
‚îÇ       ‚îî‚îÄ‚îÄ PromptBuilder.ts
‚îú‚îÄ‚îÄ ports/
‚îÇ   ‚îú‚îÄ‚îÄ AIProviderPort.ts
‚îÇ   ‚îú‚îÄ‚îÄ ChatConfigPort.ts
‚îÇ   ‚îú‚îÄ‚îÄ EventBusPort.ts
‚îÇ   ‚îî‚îÄ‚îÄ StateStorePort.ts
‚îî‚îÄ‚îÄ index.ts
```

---

## üîÑ –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏

1. `EventBus` –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ `MESSAGE_GROUP` ‚Üí `GroupAgentService.handleMessage`.
2. –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –∏ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ `MessageBuffer`.
3. `BatchProcessor` –ø–æ —Ç–∞–π–º–µ—Ä—É (–∫–∞–∂–¥—ã–µ `BATCH_INTERVAL_MS`) —Å–æ–±–∏—Ä–∞–µ—Ç –±–∞—Ç—á–∏ –ø–æ —á–∞—Ç–∞–º.
4. –ò–∑ Redis –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è (–¥–æ `HISTORY_MAX_MESSAGES` –∑–∞–ø–∏—Å–µ–π), –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∞–≥–µ–Ω—Ç–∞.
5. AI-–ø—Ä–æ–≤–∞–π–¥–µ—Ä (`GeminiAdapter`) –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ–º–ø—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `BatchClassificationResult`.
6. `DecisionOrchestrator` —Å–≤—è–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã AI —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏, —Å—Ç—Ä–æ–∏—Ç —Ä–µ—à–µ–Ω–∏—è.
7. `ActionsBuilder` –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è –≤ —Å–æ–±—ã—Ç–∏—è –¥–ª—è `EventBus`.
8. –ò—Å—Ç–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ Redis; –±—É—Ñ–µ—Ä –±–∞—Ç—á–∞ –æ—á–∏—â–∞–µ—Ç—Å—è.

---

## üîß –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### FR-1: –ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

- –ë—É—Ñ–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `MessageBuffer` (Map –≤ –ø–∞–º—è—Ç–∏ + –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ Redis).
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –∑–∞–¥–∞—é—Ç—Å—è `GROUP_AGENT_CONFIG`.
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —á–∞—Ç–æ–≤, –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–æ –æ–¥–Ω–æ–º—É —á–∞—Ç—É.

### FR-2: –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è AI

- –°–æ–æ–±—â–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π `formatMessageForAI`.
- –í –ø—Ä–æ–º–ø—Ç –ø–æ–ø–∞–¥–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—è (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è) –∏ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å Gemini (`gemma-3-27b-it`) —á–µ—Ä–µ–∑ REST API Google.
- –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ AI:

```typescript
type ClassificationType = "normal" | "violation" | "bot_mention"
type ModerationActionKind =
  | "none"
  | "warn"
  | "delete"
  | "mute"
  | "unmute"
  | "kick"
  | "ban"
  | "unban"

interface ClassificationResult {
  messageId: number
  classification: {
    type: ClassificationType
    requiresResponse: boolean
  }
  moderationAction?: ModerationActionKind
  responseText?: string
  targetUserId?: number
  targetMessageId?: number
  durationMinutes?: number
}

interface BatchClassificationResult {
  results: ClassificationResult[]
}
```

`GeminiAdapter` –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –æ—Ç–≤–µ—Ç, —Ñ–∏–ª—å—Ç—Ä—É—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ ID —Å–æ–æ–±—â–µ–Ω–∏–π —Ç–µ–∫—É—â–µ–≥–æ –±–∞—Ç—á–∞.

### FR-3: –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π

- `DecisionOrchestrator` —Å–æ–≤–º–µ—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã AI –∏ –ø–æ–ª–∏—Ç–∏–∫–∏.
- `ModerationPolicy` –Ω–µ –≤–µ–¥–µ—Ç —Å–≤–æ–∏—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤: –æ–Ω–∞ –ø—Ä–æ—Å—Ç–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `moderationAction` AI –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, —Å–≤–µ—Ä—è—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å mute).
- `ResponsePolicy` –≤—ã–±–∏—Ä–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç –Ω–∞ –±–∞—Ç—á, —É—á–∏—Ç—ã–≤–∞—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ç–∏–ø–æ–≤ (`bot_mention` ‚Üí `normal`) –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –æ—Ç–≤–µ—Ç–∞ (`AI_MAX_RESPONSE_LENGTH`).

### FR-4: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

- `ActionsBuilder` —Å—Ç—Ä–æ–∏—Ç –¥–≤–∞ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏–π:

```typescript
interface GroupAgentModerationEvent {
  chatId: number
  actions: ModerationActionDescriptor[]
}

type ModerationActionDescriptor =
  | { type: "deleteMessage"; messageId: number; reason?: string }
  | { type: "warn"; userId: number; reason: string }
  | { type: "mute"; userId: number; duration: number; reason: string }
  | { type: "unmute"; userId: number; reason?: string }
  | { type: "kick"; userId: number; reason: string }
  | { type: "ban"; userId: number; reason: string }
  | { type: "unban"; userId: number; reason?: string }

interface GroupAgentResponseEvent {
  chatId: number
  actions: Array<{
    type: "sendMessage"
    text: string
    replyToMessageId?: number
  }>
}
```

- –ï—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ—Ç, —Å–æ–±—ã—Ç–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.

### FR-5: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞

- –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ `defaultInstructions.ts`.
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `AgentInstructions`:

```typescript
interface AgentInstructions {
  agent: {
    name: string
    role: string
    character?: string
  }
  responses: {
    triggers: string[]
    rules: string
  }
  moderation: {
    rules: string
  }
  format: {
    response: string
  }
  customRules?: string
}
```

- `BatchProcessor` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `InstructionsProvider` —Å –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç). –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –±—É–¥—É—â–µ–µ.

---

## üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### EventBus

- –ü–æ–¥–ø–∏—Å–∫–∞: `eventBus.onMessageGroupOrdered(handler, priority = 5)`.
- –≠–º–∏—Å—Å–∏—è: `emitGroupAgentModerationAction`, `emitGroupAgentResponse`.
- –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–µ–π—Å—Ç–≤–∏–π Telegram ‚Äî —ç—Ç–∏–º –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è `TelegramActionsAdapter` –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ EventBus.

### ChatRepository

- –ß–µ—Ä–µ–∑ `ChatRepositoryAdapter` —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è `ChatConfigPort`:
  - `getChatConfig` (—á—Ç–µ–Ω–∏–µ API-–∫–ª—é—á–∞ –∏ —Ñ–ª–∞–≥–∞ `groupAgentEnabled`).
  - `isAdmin` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è).

### RedisService

- `RedisStateStoreAdapter` —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é (`group_agent:history:{chatId}`) –∏ –±—É—Ñ–µ—Ä—ã (`group_agent:buffer:{chatId}`) —Å TTL.
- –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–µ—Ä–≤–∏—Å–∞ –±—É—Ñ–µ—Ä —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.

### AI –ü—Ä–æ–≤–∞–π–¥–µ—Ä

- HTTP-–∫–ª–∏–µ–Ω—Ç `axiosWithProxy`, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–∫—Å–∏ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
- –ü–æ–≤—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–æ `GROUP_AGENT_CONFIG.AI_MAX_RETRIES`.
- –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞: `GROUP_AGENT_CONFIG.AI_REQUEST_TIMEOUT_MS`.

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```typescript
export const GROUP_AGENT_CONFIG = {
  BATCH_INTERVAL_MS: 10_000,
  MAX_BATCH_SIZE: 50,
  AI_REQUEST_TIMEOUT_MS: 10_000,
  AI_MAX_RETRIES: 2,
  AI_MAX_RESPONSE_LENGTH: 2_000,
  HISTORY_MAX_MESSAGES: 100,
  BUFFER_TTL_SECONDS: 3_600,
} as const
```

---

## üìä –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è MVP

- –ù–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π ‚Äî AI –¥–æ–ª–∂–µ–Ω —Å–∞–º —Ä–µ—à–∞—Ç—å —ç—Å–∫–∞–ª–∞—Ü–∏—é.
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, –±–µ–∑ —á—Ç–µ–Ω–∏—è –∏–∑ –ë–î/Redis.
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ userId –ø–æ username/reply (–æ–∂–∏–¥–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤).
- –ù–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ (–≤—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑–∞–¥–∞—é—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π).
- –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞ —Å–≤–µ–¥–µ–Ω—ã –∫ –º–∏–Ω–∏–º—É–º—É; –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –æ—à–∏–±–∫–∞–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞ —Å—á–µ—Ç retry AI –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞.

---

## üöÄ –ü–ª–∞–Ω –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –≤ `chat_configs`.
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –Ω–∞—Ä—É—à–µ–Ω–∏–π –≤ Redis –¥–ª—è —ç—Å–∫–∞–ª–∞—Ü–∏–∏ –Ω–∞–∫–∞–∑–∞–Ω–∏–π.
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, delete + warn –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ).
- UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –∞–≥–µ–Ω—Ç–∞.
- –ú–µ—Ç—Ä–∏–∫–∏ (—Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–µ–π, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π, –æ—à–∏–±–∫–∏ AI).

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025  
**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:** –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ MVP

