# üîÑ –ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã –∏ flows

–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –¥–µ–π—Å—Ç–≤–∏–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ edge cases.

**–í–µ—Ä—Å–∏—è –±–æ—Ç–∞**: 2.0.0-modular (`BOT_CONFIG.VERSION`)

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–°–∏—Å—Ç–µ–º–∞ –∫–∞–ø—á–∏](#1-—Å–∏—Å—Ç–µ–º–∞-–∫–∞–ø—á–∏)
2. [–ê–Ω—Ç–∏—Å–ø–∞–º —Å–∏—Å—Ç–µ–º–∞](#2-–∞–Ω—Ç–∏—Å–ø–∞–º-—Å–∏—Å—Ç–µ–º–∞)
3. [AI-—á–∞—Ç](#3-ai-—á–∞—Ç)
4. [–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥—Ä—É–ø–ø](#4-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è-–≥—Ä—É–ø–ø)
5. [–ö–æ–º–∞–Ω–¥—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏](#5-–∫–æ–º–∞–Ω–¥—ã-–º–æ–¥–µ—Ä–∞—Ü–∏–∏)
6. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏](#6-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏)

---

## 1. –°–∏—Å—Ç–µ–º–∞ –∫–∞–ø—á–∏

### 1.1. –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞

**–¢—Ä–∏–≥–≥–µ—Ä:** –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –≥—Ä—É–ø–ø–µ (`chat_member` —Å–æ–±—ã—Ç–∏–µ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞)

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π:**

```
1. Telegram ‚Üí chat_member —Å–æ–±—ã—Ç–∏–µ
   (—Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏–ª—Å—è: left/kicked ‚Üí member/restricted)
   ‚Üì
2. MemberHandler.handleChatMember()
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —á–∞—Ç–∞
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
   ‚îú‚îÄ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚îî‚îÄ EventBus.emit(MEMBER_JOINED)
   ‚Üì
3. CaptchaService (–ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ member.joined)
   ‚îî‚îÄ startChallenge()
   ‚îú‚îÄ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞–ø—á–∏ (–æ–∫–Ω–æ 2 —Å–µ–∫)
   ‚îú‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ (—á–∏—Å–ª–∞ 1-10, —Å–ª–æ–∂–µ–Ω–∏–µ)
   ‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ 4 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞ (1 –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π + 3 —Å–ª—É—á–∞–π–Ω—ã—Ö)
   ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ Redis (TTL: 5 –º–∏–Ω—É—Ç)
   ‚Üì
4. EventBus.emit("captcha.challenge")
   ‚îú‚îÄ actions: [
   ‚îÇ   ‚îú‚îÄ sendMessage (—Å inline –∫–Ω–æ–ø–∫–∞–º–∏)
   ‚îÇ   ‚îî‚îÄ restrict (can_send_messages: false)
   ‚îÇ  ]
   ‚Üì
5. TelegramActionsAdapter ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç actions
   ‚îú‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–∞–ø—á–µ–π
   ‚îú‚îÄ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚îî‚îÄ –≠–º–∏—Å—Å–∏—è —Å–æ–±—ã—Ç–∏—è captcha.messageSent —Å messageId
   ‚Üì
6. CaptchaService ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç questionId –≤ Redis
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –¢–∞–π–º–∞—É—Ç: 60 —Å–µ–∫—É–Ω–¥ (`CAPTCHA_TIMEOUT_MS`)
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤: 5 —Å–µ–∫—É–Ω–¥ (`CAPTCHA_CHECK_INTERVAL_MS`)
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è: –æ–∫–Ω–æ 2 —Å–µ–∫—É–Ω–¥—ã (`duplicateWindowMs`)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –°–æ–±—ã—Ç–∏–µ `new_chat_members` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏. –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–∞–ø—á–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ `chat_member` —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞.

**–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–ø—á–∏:**
```
–ü—Ä–∏–≤–µ—Ç, @username! –†–µ—à–∏ –ø—Ä–∏–º–µ—Ä: 5 + 3 = ?
[–ö–Ω–æ–ø–∫–∞: 7] [–ö–Ω–æ–ø–∫–∞: 8] [–ö–Ω–æ–ø–∫–∞: 9] [–ö–Ω–æ–ø–∫–∞: 10]
```

### 1.2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–¢—Ä–∏–≥–≥–µ—Ä:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –Ω–∞ –∫–Ω–æ–ø–∫—É –æ—Ç–≤–µ—Ç–∞ (`callback_query`)

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π:**

```
1. Telegram ‚Üí callback_query —Å–æ–±—ã—Ç–∏–µ
   ‚Üì
2. CallbackHandler ‚Üí –ø–∞—Ä—Å–∏—Ç callback_data
   –§–æ—Ä–º–∞—Ç: "captcha_{userId}_{optionIndex}_{correct|wrong}"
   ‚Üì
3. CaptchaService.submitAnswer()
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞–ø—á–∏
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
   ‚îú‚îÄ –û—Ç–º–µ—Ç–∫–∞ –∫–∞–∫ –æ—Ç–≤–µ—á–µ–Ω–Ω–æ–≥–æ (isAnswered = true)
   ‚îî‚îÄ –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ Redis
   ‚Üì
4a. –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –ü–†–ê–í–ò–õ–¨–ù–´–ô:
    EventBus.emit(CAPTCHA_PASSED)
    ‚îú‚îÄ actions: [
    ‚îÇ   ‚îú‚îÄ unrestrict (can_send_messages: true)
    ‚îÇ   ‚îî‚îÄ deleteMessage (—É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–ø—á–∏)
    ‚îÇ  ]
    ‚Üì
    TelegramActionsAdapter ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç actions
    ‚îî‚îÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞

4b. –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô:
    EventBus.emit(CAPTCHA_FAILED)
    ‚îú‚îÄ actions: [
    ‚îÇ   ‚îú‚îÄ deleteMessage (—É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–ø—á–∏)
    ‚îÇ   ‚îî‚îÄ ban (–≤—Ä–µ–º–µ–Ω–Ω—ã–π –±–∞–Ω –Ω–∞ 60 —Å–µ–∫—É–Ω–¥)
    ‚îÇ  ]
    ‚Üì
    TelegramActionsAdapter ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç actions
    ‚îî‚îÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π –±–∞–Ω
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–≤–æ—é –∫–∞–ø—á—É
- Callback –æ—Ç –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è

### 1.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–∞

**–¢—Ä–∏–≥–≥–µ—Ä:** –ò—Å—Ç–µ–∫–ª–æ 60 —Å–µ–∫—É–Ω–¥ –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥)

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π:**

```
1. CaptchaService ‚Üí –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–∞–π–º–∞—É—Ç–æ–≤ (checkTimeouts)
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–ø—á
   ‚îú‚îÄ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏—Å—Ç–µ–∫—à–∏—Ö (timestamp + timeoutMs < now)
   ‚îî‚îÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–µ–∫—à–µ–≥–æ
   ‚Üì
2. handleCaptchaTimeout()
   ‚îú‚îÄ EventBus.emit(CAPTCHA_FAILED)
   ‚îÇ  ‚îú‚îÄ reason: "timeout"
   ‚îÇ  ‚îî‚îÄ actions: [
   ‚îÇ      ‚îú‚îÄ deleteMessage
   ‚îÇ      ‚îî‚îÄ ban (60 —Å–µ–∫—É–Ω–¥)
   ‚îÇ     ]
   ‚îî‚îÄ –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ Redis
   ‚Üì
3. TelegramActionsAdapter ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç actions
   ‚îî‚îÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π –±–∞–Ω
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–±–∞–Ω —á–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥ (Telegram API `until_date`)
- –°–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–ø—á–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## 2. –ê–Ω—Ç–∏—Å–ø–∞–º —Å–∏—Å—Ç–µ–º–∞

### 2.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–¢—Ä–∏–≥–≥–µ—Ä:** –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ (`MESSAGE_RECEIVED` —Å–æ–±—ã—Ç–∏–µ)

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π:**

```
1. Telegram ‚Üí MESSAGE_RECEIVED —Å–æ–±—ã—Ç–∏–µ
   ‚Üì
2. AntiSpamService ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ EventBus.onMessageGroupOrdered
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—á–µ—Ç—á–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚îÇ  ‚îî‚îÄ –ï—Å–ª–∏ > 5 —Å–æ–æ–±—â–µ–Ω–∏–π ‚Üí –ø—Ä–æ–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏
   ‚îú‚îÄ –ï—Å–ª–∏ ‚â§ 5 —Å–æ–æ–±—â–µ–Ω–∏–π ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ø–∞–º
   ‚Üì
3. checkMessage() ‚Üí –∑–∞–ø—Ä–æ—Å –∫ –≤–Ω–µ—à–Ω–µ–º—É API
   ‚îú‚îÄ URL: ANTISPAM_URL (–ø–æ—Ä—Ç 6323)
   ‚îú‚îÄ –¢–∞–π–º–∞—É—Ç: 5 —Å–µ–∫—É–Ω–¥
   ‚îú‚îÄ –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫: 2
   ‚îú‚îÄ –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏: 1 —Å–µ–∫—É–Ω–¥–∞
   ‚îî‚îÄ –û—Ç–≤–µ—Ç: { is_spam: boolean, confidence?: number, reason?: string }
   ‚Üì
4a. –ï—Å–ª–∏ –ù–ï —Å–ø–∞–º:
    ‚îî‚îÄ –ü—Ä–æ–ø—É—Å–∫ (—Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–∞–ª—å—à–µ)

4b. –ï—Å–ª–∏ –°–ü–ê–ú:
    ‚îú‚îÄ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —Å–ø–∞–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ‚îú‚îÄ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä–∞–¥–∞—Ü–∏–∏ –Ω–∞–∫–∞–∑–∞–Ω–∏—è
    ‚îî‚îÄ EventBus.emit(SPAM_DETECTED)
       ‚îî‚îÄ actions: [deleteMessage, sendMessage, kick (–ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö)]
    ‚Üì
5. TelegramActionsAdapter ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç actions
```

**–ì—Ä–∞–¥–∞—Ü–∏—è –Ω–∞–∫–∞–∑–∞–Ω–∏–π:**

| –°—á–µ—Ç—á–∏–∫ —Å–ø–∞–º–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------------|----------|
| 1 | –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ |
| 2 | –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ |
| 3+ | –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ –∫–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

**–û—á–∏—Å—Ç–∫–∞ —Å—á–µ—Ç—á–∏–∫–æ–≤:**
- –°—á–µ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π: TTL 48 —á–∞—Å–æ–≤ –≤ Redis
- –°—á–µ—Ç—á–∏–∫–∏ —Å–ø–∞–º–∞: TTL 24 —á–∞—Å–∞ –≤ Redis
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ TTL

### 2.2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API

**–°—Ü–µ–Ω–∞—Ä–∏–∏:**
- –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ (5 —Å–µ–∫—É–Ω–¥) ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
- –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ ‚Üí –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ (—Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è)
- –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω API ‚Üí —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞

---

## 3. AI-—á–∞—Ç

### 3.1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ AI

**–¢—Ä–∏–≥–≥–µ—Ä:** –°–æ–æ–±—â–µ–Ω–∏–µ, –∞–¥—Ä–µ—Å–æ–≤–∞–Ω–Ω–æ–µ –±–æ—Ç—É (—É–ø–æ–º–∏–Ω–∞–Ω–∏–µ `@botname` –∏–ª–∏ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞)

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π:**

```
1. Telegram ‚Üí MESSAGE_RECEIVED —Å–æ–±—ã—Ç–∏–µ
   ‚Üì
2. MessageHandler ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ AI
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –±–æ—Ç–∞ –∏–ª–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —á–∞—Ç–∞ (—Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø—ã, –Ω–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ)
   ‚îî‚îÄ AIChatService.processMessage()
   ‚Üì
3. AIChatService.processMessage()
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞: AI –≤–∫–ª—é—á–µ–Ω –≤ —á–∞—Ç–µ? (getChatConfig)
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞: API –∫–ª—é—á —Å—É—â–µ—Å—Ç–≤—É–µ—Ç? (getApiKeyForChat)
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª–∏–Ω–∞, —Å–ø–∞–º-–ø–∞—Ç—Ç–µ—Ä–Ω—ã)
   ‚îú‚îÄ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
   ‚îÇ  ‚îî‚îÄ –§–æ—Ä–º–∞—Ç: "[time][@username][name]: [message]"
   ‚îî‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å (queueManager.enqueue)
   ‚Üì
4. –û—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (startQueueProcessor)
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–∏ (MAX_QUEUE_SIZE = 10)
   ‚îú‚îÄ –ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí –æ—Ç–∫–∞–∑
   ‚îú‚îÄ –ó–∞–ø—É—Å–∫ typing –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
   ‚îî‚îÄ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
   ‚Üì
5. processQueuedMessage()
   ‚îú‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞/—Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (Redis cache)
   ‚îú‚îÄ –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ throttling (token bucket)
   ‚îú‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ Gemini API
   ‚îÇ  ‚îú‚îÄ –ú–æ–¥–µ–ª—å: getChatModel()
   ‚îÇ  ‚îú‚îÄ Max tokens: MAX_RESPONSE_LENGTH (4000)
   ‚îÇ  ‚îú‚îÄ Temperature: 1.8
   ‚îÇ  ‚îî‚îÄ –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∏–∑ –ë–î –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
   ‚îú‚îÄ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
   ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
   ‚Üì
6. EventBus.emit(AI_RESPONSE)
   ‚îî‚îÄ actions: [sendMessage]
   ‚Üì
7. TelegramActionsAdapter ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
   ‚îî‚îÄ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ typing –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚úÖ AI –≤–∫–ª—é—á–µ–Ω –≤ —á–∞—Ç–µ (`aiEnabled = true`)
- ‚úÖ API –∫–ª—é—á —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (`geminiApiKey != null`)
- ‚úÖ –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ < 10 —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –î–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è ‚â§ 4000 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–ø–∞–º–æ–º

**–û—à–∏–±–∫–∏:**
- –û—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥–∏"
- API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí "API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω"
- AI –æ—Ç–∫–ª—é—á–µ–Ω ‚Üí "AI –æ—Ç–∫–ª—é—á–µ–Ω –≤ —ç—Ç–æ–º —á–∞—Ç–µ"

### 3.2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:**
```typescript
{
  chatId: number,
  messages: Array<{
    role: "user" | "model",
    content: string,
    timestamp: number
  }>,
  lastActivity: number,
  requestCount: number
}
```

**–ü—Ä–æ—Ü–µ—Å—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
1. –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Redis (TTL: 24 —á–∞—Å–∞)
2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –û–±—Ä–µ–∑–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ 500 —Å–æ–æ–±—â–µ–Ω–∏–π (`MAX_CONTEXT_MESSAGES`)
4. –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (`CONTEXT_SAVE_INTERVAL_MS`)
5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞

**–û—á–∏—Å—Ç–∫–∞:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ (30 –º–∏–Ω—É—Ç –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è)
- –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (in-memory –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã)

### 3.3. –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ throttling

**Token Bucket –∞–ª–≥–æ—Ä–∏—Ç–º:**
- –ï–º–∫–æ—Å—Ç—å: 6 —Ç–æ–∫–µ–Ω–æ–≤ (`BUCKET_CAPACITY`)
- –¢–æ–∫–µ–Ω–æ–≤ –∑–∞ –∑–∞–ø—Ä–æ—Å: 1 (`TOKENS_PER_REQUEST`)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 20 —Å–µ–∫—É–Ω–¥ (`MAX_DELAY`)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 5 —Å–µ–∫—É–Ω–¥ (`MIN_DELAY`)

**–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ –¥–ª–∏–Ω–µ –æ—Ç–≤–µ—Ç–∞:**
- –ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç (‚â§ 100 —Å–∏–º–≤–æ–ª–æ–≤) ‚Üí –±–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏
- –°—Ä–µ–¥–Ω–∏–π –æ—Ç–≤–µ—Ç (100-500 —Å–∏–º–≤–æ–ª–æ–≤) ‚Üí –ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è
- –î–ª–∏–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (‚â• 500 —Å–∏–º–≤–æ–ª–æ–≤) ‚Üí 20 —Å–µ–∫—É–Ω–¥ –∑–∞–¥–µ—Ä–∂–∫–∏

**Cleanup:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö bucket'–æ–≤ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –¢–∞–π–º–∞—É—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: 30 –º–∏–Ω—É—Ç

---

## 4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥—Ä—É–ø–ø

### 4.1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥—Ä—É–ø–ø—ã (`/register`)

**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–æ–º–∞–Ω–¥–∞ `/register` –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≥—Ä—É–ø–ø—ã

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π:**

```
1. Telegram ‚Üí –∫–æ–º–∞–Ω–¥–∞ /register
   ‚Üì
2. CommandHandler ‚Üí –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–∞–Ω–¥—ã
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞: –∫–æ–º–∞–Ω–¥–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –≥—Ä—É–ø–ø (chatId < 0)
   ‚îî‚îÄ EventBus.emitCommandRegister()
   ‚Üì
3. GroupManagementService.handleRegister()
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤: AuthorizationService.checkGroupAdmin()
   ‚îÇ  ‚îî‚îÄ –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —á–∞—Ç–∞ –≤ –ë–î
   ‚îÇ  ‚îú‚îÄ –ï—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
   ‚îÇ  ‚îÇ  ‚îî‚îÄ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏–∑ Telegram API
   ‚îÇ  ‚îÇ     ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (group_admins)
   ‚îÇ  ‚îî‚îÄ –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
   ‚îÇ     ‚îú‚îÄ –ï—Å–ª–∏ active = true ‚Üí "–ì—Ä—É–ø–ø–∞ —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞"
   ‚îÇ     ‚îî‚îÄ –ï—Å–ª–∏ active = false ‚Üí –∞–∫—Ç–∏–≤–∞—Ü–∏—è
   ‚îî‚îÄ ChatRepository.registerChat()
      ‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ chats
      ‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ chat_configs
      ‚îî‚îÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ active = true
   ‚Üì
4. –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   ‚îî‚îÄ "–ì—Ä—É–ø–ø–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞" –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –≥—Ä—É–ø–ø (–Ω–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã)
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≥—Ä—É–ø–ø—ã
- ‚úÖ –ì—Ä—É–ø–ø–∞ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∏–ª–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `chats`
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `chat_configs` (aiEnabled = true –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –≤ `group_admins`

### 4.2. –û—Ç–º–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (`/unregister`)

**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–æ–º–∞–Ω–¥–∞ `/unregister` –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≥—Ä—É–ø–ø—ã

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π:**

```
1. Telegram ‚Üí –∫–æ–º–∞–Ω–¥–∞ /unregister
   ‚Üì
2. CommandHandler ‚Üí EventBus.emitCommandUnregister()
   ‚Üì
3. GroupManagementService.handleUnregister()
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤: AuthorizationService.checkGroupAdmin()
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —á–∞—Ç–∞
   ‚îî‚îÄ ChatRepository.unregisterChat()
      ‚îî‚îÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ active = false (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
   ‚Üì
4. –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   ‚îî‚îÄ "–ì—Ä—É–ø–ø–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞"
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ: –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ë–î, –Ω–æ `active = false`
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ë–î
- –ú–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `/register`

---

## 5. –ö–æ–º–∞–Ω–¥—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏

### 5.1. –ë–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`/ban @username`)

**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–æ–º–∞–Ω–¥–∞ `/ban` –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≥—Ä—É–ø–ø—ã

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π:**

```
1. Telegram ‚Üí –∫–æ–º–∞–Ω–¥–∞ /ban @username
   ‚Üì
2. CommandHandler ‚Üí –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–∞–Ω–¥—ã
   ‚îú‚îÄ –§–æ—Ä–º–∞—Ç: /ban @username –∏–ª–∏ /ban (reply-to-message)
   ‚îî‚îÄ EventBus.emitCommandBan()
   ‚Üì
3. ModerationService.handleBan()
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞: –∫–æ–º–∞–Ω–¥–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –≥—Ä—É–ø–ø
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤: AuthorizationService.checkGroupAdmin()
   ‚îú‚îÄ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   ‚îÇ  ‚îú‚îÄ –ü–æ username (—á–µ—Ä–µ–∑ UserManager)
   ‚îÇ  ‚îî‚îÄ –ü–æ reply-to-message (–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
   ‚îî‚îÄ EventBus.emitAIResponse()
      ‚îî‚îÄ actions: [
          ‚îú‚îÄ deleteMessage (–∫–æ–º–∞–Ω–¥–∞)
          ‚îú‚îÄ kick (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
          ‚îî‚îÄ sendMessage (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)
         ]
   ‚Üì
4. TelegramActionsAdapter ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç actions
   ‚îî‚îÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ –≥—Ä—É–ø–ø—ã
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
- `/ban @username` - –ø–æ username
- `/ban` (reply-to-message) - –ø–æ –æ—Ç–≤–µ—Ç—É –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è:**
- `/unban` - —Ä–∞–∑–±–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/mute` - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
- `/unmute` - –≤–∫–ª—é—á–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è

### 5.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤

**–£—Ä–æ–≤–Ω–∏ –¥–æ—Å—Ç—É–ø–∞:**
1. **–°—É–ø–µ—Ä–∞–¥–º–∏–Ω** (`ADMIN_USERNAME`) - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º
2. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≥—Ä—É–ø–ø—ã** (–∏–∑ –ë–î `group_admins`) - –∫–æ–º–∞–Ω–¥—ã –≤ —Å–≤–æ–∏—Ö –≥—Ä—É–ø–ø–∞—Ö
3. **–û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** - –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- `AuthorizationService.checkGroupAdmin()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –ë–î
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ –ë–î ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Telegram API
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –ø–∞–º—è—Ç–∏

---

## 6. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

### 6.1. –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ AI (`/ultron [1/0]`)

**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–æ–º–∞–Ω–¥–∞ `/ultron` –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π:**

```
1. Telegram ‚Üí –∫–æ–º–∞–Ω–¥–∞ /ultron [1/0]
   ‚Üì
2. CommandHandler ‚Üí –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–∞–Ω–¥—ã
   ‚îú‚îÄ –§–æ—Ä–º–∞—Ç: /ultron [1/0] –∏–ª–∏ /ultron @chatname [1/0]
   ‚îî‚îÄ EventBus.emitCommandUltronToggle()
   ‚Üì
3. ChatConfigurationService.handleUltronToggle()
   ‚îú‚îÄ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–≥–æ —á–∞—Ç–∞:
   ‚îÇ  ‚îú‚îÄ –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω @chatname:
   ‚îÇ  ‚îÇ  ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤: —Ç–æ–ª—å–∫–æ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω
   ‚îÇ  ‚îÇ  ‚îî‚îÄ –ü–æ–∏—Å–∫ —á–∞—Ç–∞ –ø–æ username
   ‚îÇ  ‚îî‚îÄ –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω: —Ç–µ–∫—É—â–∏–π —á–∞—Ç
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤: AuthorizationService.checkGroupAdmin()
   ‚îî‚îÄ ChatRepository.toggleAi(chatId, enabled)
      ‚îî‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ chat_configs.aiEnabled
   ‚Üì
4. –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   ‚îî‚îÄ "AI –≤–∫–ª—é—á–µ–Ω/–≤—ã–∫–ª—é—á–µ–Ω" –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ —Ç–µ–∫—É—â–µ–º —á–∞—Ç–µ: `/ultron 1` –∏–ª–∏ `/ultron 0`
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –¥—Ä—É–≥–æ–º —á–∞—Ç–µ (—Ç–æ–ª—å–∫–æ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω): `/ultron @chatname 1`
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- –ö–µ—à –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 6.2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞ (`/addAltronKey @group API_KEY`)

**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–æ–º–∞–Ω–¥–∞ `/addAltronKey` –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —á–∞—Ç–µ —Å –±–æ—Ç–æ–º

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π:**

```
1. Telegram ‚Üí –∫–æ–º–∞–Ω–¥–∞ /addAltronKey @group API_KEY
   ‚Üì
2. CommandHandler ‚Üí –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–∞–Ω–¥—ã
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞: –∫–æ–º–∞–Ω–¥–∞ —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —á–∞—Ç–µ (chatId > 0)
   ‚îî‚îÄ EventBus.emitCommandAddAltronKey()
   ‚Üì
3. ChatConfigurationService.handleAddAltronKey()
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –∫–æ–º–∞–Ω–¥—ã
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã API –∫–ª—é—á–∞ (‚â§ 50 —Å–∏–º–≤–æ–ª–æ–≤, –≤ –ë–î –¥–æ 512)
   ‚îú‚îÄ –ü–æ–∏—Å–∫ —á–∞—Ç–∞ –ø–æ username
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤:
   ‚îÇ  ‚îú‚îÄ –°—É–ø–µ—Ä–∞–¥–º–∏–Ω ‚Üí –¥–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω
   ‚îÇ  ‚îî‚îÄ –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ isAdmin() –≤ –ë–î
   ‚îî‚îÄ ChatRepository.setApiKey(chatId, apiKey)
      ‚îî‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ chat_configs.geminiApiKey
   ‚Üì
4. –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   ‚îî‚îÄ "API –∫–ª—é—á —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –¥–ª—è @group" –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ö–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —á–∞—Ç–µ —Å –±–æ—Ç–æ–º
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —Ü–µ–ª–µ–≤–æ–π –≥—Ä—É–ø–ø—ã
- –°—É–ø–µ—Ä–∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á –¥–ª—è –ª—é–±–æ–π –≥—Ä—É–ø–ø—ã

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- API –∫–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ (–Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤)
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –≥—Ä—É–ø–ø—ã
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –∏ –¥–ª–∏–Ω—ã

---

## üîÑ Event-Driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–í—Å–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç Event-Driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —á–µ—Ä–µ–∑ `EventBus`:

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:

| –°–æ–±—ã—Ç–∏–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ | –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|------------|------------|
| `MESSAGE_RECEIVED` | MessageHandler | AntiSpamService, AIChatService, AIModerationService | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π |
| `captcha.challenge` | CaptchaService | TelegramActionsAdapter | –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞–ø—á–∏ |
| `CAPTCHA_PASSED` | CaptchaService | TelegramActionsAdapter | –£—Å–ø–µ—à–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ |
| `CAPTCHA_FAILED` | CaptchaService | TelegramActionsAdapter | –ù–µ—É–¥–∞—á–∞/—Ç–∞–π–º–∞—É—Ç |
| `SPAM_DETECTED` | AntiSpamService | TelegramActionsAdapter | –û–±–Ω–∞—Ä—É–∂–µ–Ω —Å–ø–∞–º |
| `AI_RESPONSE` | AIChatService | TelegramActionsAdapter | –ì–æ—Ç–æ–≤ –æ—Ç–≤–µ—Ç AI |
| `CommandRegister` | CommandHandler | GroupManagementService | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥—Ä—É–ø–ø—ã |
| `CommandBan` | CommandHandler | ModerationService | –ë–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `CommandUltronToggle` | CommandHandler | ChatConfigurationService | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ AI |

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- –°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π —á–µ—Ä–µ–∑ `TelegramActionsAdapter`
- –ò–∑–æ–ª—è—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –æ—Ç Telegram API

---

## üìä –î–∏–∞–≥—Ä–∞–º–º—ã –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

### –û–±—â–∏–π flow –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:

```
Telegram API
    ‚Üì
TelegramBotService
    ‚Üì
MessageHandler
    ‚Üì
EventBus.emit(MESSAGE_RECEIVED)
    ‚îú‚îÄ‚Üí AntiSpamService (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–≤—ã—Ö 5 —Å–æ–æ–±—â–µ–Ω–∏–π)
    ‚îú‚îÄ‚Üí AIChatService (–æ–±—Ä–∞–±–æ—Ç–∫–∞ AI –∑–∞–ø—Ä–æ—Å–æ–≤)
    ‚îî‚îÄ‚Üí AIModerationService (–±–∞—Ç—á–µ–≤–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è)
```

### Flow –∫–∞–ø—á–∏:

```
chat_member (—Å—Ç–∞—Ç—É—Å: left/kicked ‚Üí member/restricted)
    ‚Üì
MemberHandler.handleChatMember()
    ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —á–∞—Ç–∞
    ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
    ‚îî‚îÄ EventBus.emit(MEMBER_JOINED)
    ‚Üì
CaptchaService (–ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ member.joined)
    ‚îî‚îÄ startChallenge()
    ‚îú‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ—Ä–∞
    ‚îú‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis
    ‚îî‚îÄ EventBus.emit("captcha.challenge")
    ‚Üì
TelegramActionsAdapter
    ‚îú‚îÄ sendMessage (–∫–∞–ø—á–∞)
    ‚îî‚îÄ restrict (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ)
    ‚Üì
callback_query (–æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    ‚Üì
CallbackHandler
    ‚Üì
CaptchaService.submitAnswer()
    ‚Üì
EventBus.emit(CAPTCHA_PASSED | CAPTCHA_FAILED)
    ‚Üì
TelegramActionsAdapter
    ‚îú‚îÄ unrestrict | ban
    ‚îî‚îÄ deleteMessage
```

---

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
1. **Graceful degradation** - –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
4. **Retry –º–µ—Ö–∞–Ω–∏–∑–º—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∞:

| –û—à–∏–±–∫–∞ | –û–±—Ä–∞–±–æ—Ç–∫–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|--------|-----------|-----------|
| Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | Retry –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä—ã) | –ë–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É |
| Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –∫–µ—à–∞ | –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ |
| –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤–æ–∑–≤—Ä–∞—Ç null/false | –ö–æ–º–∞–Ω–¥—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–æ –±–æ—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç |
| –í–Ω–µ—à–Ω–∏–π API –∞–Ω—Ç–∏—Å–ø–∞–º–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | –ü—Ä–æ–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | –°–ø–∞–º –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| Gemini API –æ—à–∏–±–∫–∞ | –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ (max 3), –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | AI –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, –Ω–æ –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç |

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ `constants.ts`
- –í—Å–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –æ–ø–∏—Å–∞–Ω—ã –≤ `BUSINESS_RULES.md`
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–ø–∏—Å–∞–Ω–∞ –≤ `ARCHITECTURE.md`
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

