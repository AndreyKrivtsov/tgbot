# üß™ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ Telegram Bot.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- [–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤](#–∑–∞–ø—É—Å–∫-—Ç–µ—Å—Ç–æ–≤)
- [–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã](#—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ-—Ç–µ—Å—Ç—ã)
- [–ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤](#–Ω–∞–ø–∏—Å–∞–Ω–∏–µ-–Ω–æ–≤—ã—Ö-—Ç–µ—Å—Ç–æ–≤)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

## üéØ –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Jest** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤. –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∫–ª—é—á–∞–µ—Ç:

### –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤:
- **üîß –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã** - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
- **üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

### –¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:
- **CaptchaService** ‚úÖ (–Æ–Ω–∏—Ç)
- **AntiSpamService** ‚úÖ (–Æ–Ω–∏—Ç)
- **AntiSpam Flow** ‚úÖ (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π)
- **Captcha Flow** ‚úÖ (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π)
- **Container** üîÑ (–í –ø–ª–∞–Ω–∞—Ö)
- **Configuration** üîÑ (–í –ø–ª–∞–Ω–∞—Ö)

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

```json
{
  "@types/jest": "^29.5.12",
  "jest": "^29.7.0",
  "ts-jest": "^29.1.2"
}
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jest –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `jest.config.js`:

```javascript
export default {
  preset: "ts-jest",
  testEnvironment: "node",
  testMatch: [
    "**/__tests__/**/*.test.ts",
    "**/__tests__/**/*.test.js"
  ],
  collectCoverageFrom: [
    "src/**/*.ts",
    "!src/**/*.d.ts",
    "!src/index.ts",
    "!src/**/__tests__/**"
  ]
}
```

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
npm test

# –¢–æ–ª—å–∫–æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
npm run test:unit

# –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
npm run test:integration

# –†–µ–∂–∏–º –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
npm run test:watch

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
npm run test:coverage

# CI —Ä–µ–∂–∏–º
npm run test:ci
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
npm test CaptchaService.test.js
npm test AntiSpamService.test.js

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º
npm test -- --testNamePattern="–≥–µ–Ω–µ—Ä–∞—Ü–∏—è"
```

## üìù –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã

### CaptchaService Tests

**–§–∞–π–ª**: `src/__tests__/unit/services/CaptchaService.test.js`

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è**:
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—ä–µ–∫—Ç–∞ –∫–∞–ø—á–∏ (question, answer, options)

**–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞**:
```javascript
test("–¥–æ–ª–∂–µ–Ω –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∑–∞–¥–∞—á—É", () => {
  const captcha = generateCaptcha()

  expect(captcha.question).toHaveLength(2)
  expect(captcha.answer).toBe(captcha.question[0] + captcha.question[1])
  expect(captcha.options).toContain(captcha.answer)
})
```

### AntiSpamService Tests

**–§–∞–π–ª**: `src/__tests__/unit/services/AntiSpamService.test.js`

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è**:
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–∞–º —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –°—á–µ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π (–ª–∏–º–∏—Ç 5)
- ‚úÖ –ú–æ–∫ API –æ—Ç–≤–µ—Ç–æ–≤

**–ü—Ä–∏–º–µ—Ä –º–æ–∫ API**:
```javascript
const mockResponse = {
  isSpam: true,
  confidence: 0.95,
  reason: "–°–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∞–º —Å–ª–æ–≤–∞"
}

const result = checkMessageForSpam(message, mockResponse)
expect(result.action).toBe("block")
```

### üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### AntiSpam Flow Test (9 —Ç–µ—Å—Ç–æ–≤)

**–§–∞–π–ª**: `src/__tests__/integration/AntiSpamFlow.test.js`

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:**
- üì® –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–æ–º ‚Üí AntiSpamService ‚Üí AI API ‚Üí –¥–µ–π—Å—Ç–≤–∏–µ
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ)
- üö´ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–ø–∞–º–∞ —Å –º–æ–∫ API –æ—Ç–≤–µ—Ç–∞–º–∏
- üî§ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ø–∞–º–∞ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
- üî¢ –õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ (5 —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ AI API
- üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üéØ –†–∞–∑–ª–∏—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ AI (0.05 - 0.98)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
```javascript
// –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É: –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
test("–¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ", async () => {
  const message = createMockMessage("–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º! –ö–∞–∫ –¥–µ–ª–∞?")
  const result = await botService.handleNewMessage(message)

  expect(result.action).toBe("allow")
  expect(result.isSpam).toBe(false)
  expect(botService.deletedMessages).toHaveLength(0)
})

// –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É: —Å–ø–∞–º —Å –º–æ–∫ API
test("–¥–æ–ª–∂–µ–Ω –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å —Å–ø–∞–º —Å –º–æ–∫ API", async () => {
  const mockResponse = {
    isSpam: true,
    confidence: 0.85,
    reason: "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã"
  }

  const result = await antiSpamService.checkMessage(message, mockResponse)
  expect(result.isSpam).toBe(true)
  expect(result.action).toBe("delete")
})
```

#### Captcha Flow Test (10 —Ç–µ—Å—Ç–æ–≤)

**–§–∞–π–ª**: `src/__tests__/integration/CaptchaFlow.test.js`

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:**
- üëã –í—Ö–æ–¥ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ ‚Üí –∫–∞–ø—á–∞ ‚Üí –æ—Ç–≤–µ—Ç ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- üîê –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∫–∞–ø—á —Å 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç ‚Üí —Å–Ω—è—Ç–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π ‚Üí –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ (3 –ø–æ–ø—ã—Ç–∫–∏ –º–∞–∫—Å–∏–º—É–º)
- üë¢ –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –ø–æ–ø—ã—Ç–æ–∫ ‚Üí –∫–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚è∞ –¢–∞–π–º–∞—É—Ç –∫–∞–ø—á–∏ (1 –º–∏–Ω—É—Ç–∞) ‚Üí –∫–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üë• –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- üßπ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∫–∞–ø—á
- üîç –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞–ø—á

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
```javascript
// –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É: –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
test("–¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Ö–æ–¥ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", async () => {
  const joinEvent = createMockJoinEvent()
  const result = await botService.handleNewMember(joinEvent)

  expect(result.action).toBe("captcha_generated")
  expect(result.captcha.question).toMatch(/\d+ \+ \d+ = \?/)
  expect(result.captcha.options).toHaveLength(4)
  expect(botService.restrictedUsers.has(mockNewUser.id)).toBe(true)
})

// –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
test("–¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –∫–∞–ø—á—É", async () => {
  const callbackQuery = createMockCallbackQuery(
    mockNewUser.id,
    `captcha_answer_${mockNewUser.id}_${captcha.correctIndex}`,
    messageId
  )

  const result = await botService.handleCallbackQuery(callbackQuery)

  expect(result.success).toBe(true)
  expect(result.action).toBe("allow")
  expect(botService.restrictedUsers.has(mockNewUser.id)).toBe(false)
})

// –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É: –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –ø–æ–ø—ã—Ç–æ–∫
test("–¥–æ–ª–∂–µ–Ω –∫–∏–∫–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ 3 –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤", async () => {
  // ... 3 –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞ –ø–æ–¥—Ä—è–¥

  expect(botService.kickedUsers).toHaveLength(1)
  expect(botService.kickedUsers[0].reason).toContain("–ü—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫")
})
```

**–ú–æ–∫-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `MockCaptchaService` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞–ø—á, –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤, —Ç–∞–π–º–∞—É—Ç—ã
- `MockTelegramBotService` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∫–∏–∫, –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü–æ–ª–Ω–∞—è —Å–∏–º—É–ª—è—Ü–∏—è callback query –∏ inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä

## ‚úçÔ∏è –ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞

```javascript
describe("ServiceName", () => {
  describe("–ì—Ä—É–ø–ø–∞ —Ç–µ—Å—Ç–æ–≤", () => {
    test("–¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ", () => {
      // Arrange - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
      const input = "test data"

      // Act - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
      const result = serviceFunction(input)

      // Assert - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      expect(result).toBe("expected")
    })
  })
})
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–§–∞–π–ª—ã —Ç–µ—Å—Ç–æ–≤**: —Ä–∞–∑–º–µ—â–∞–π—Ç–µ –≤ `src/__tests__/unit/services/`
2. **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—Ñ—Ñ–∏–∫—Å `.test.js`
3. **–û–ø–∏—Å–∞–Ω–∏—è**: –ø–∏—à–∏—Ç–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –¥–ª—è –ø–æ–Ω—è—Ç–Ω–æ—Å—Ç–∏
4. **–ú–æ–∫–∏**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω—ã—Ö –º–æ–∫–æ–≤
5. **–ò–∑–æ–ª—è—Ü–∏—è**: –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º

### –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫–∞ —Å–µ—Ä–≤–∏—Å–∞

```javascript
// –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏
function serviceFunction(input, mockApiResponse) {
  // –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
  if (!input) {
    return { error: "–ù–µ—Ç –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö" }
  }

  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–∫–∞ –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
  const response = mockApiResponse || { success: true }

  return {
    input,
    processed: true,
    response
  }
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

```javascript
// src/__tests__/integration/NewFlow.test.js
describe("New Integration Flow", () => {
  // –ú–æ–∫ –∫–ª–∞—Å—Å—ã –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
  class MockService1 {
    constructor() {
      this.events = []
      this.onEventProcessed = null
    }

    async processEvent(eventData) {
      this.events.push(eventData)
      const result = { processed: true, eventData }

      if (this.onEventProcessed) {
        this.onEventProcessed(result)
      }

      return result
    }
  }

  class MockService2 {
    constructor(service1) {
      this.service1 = service1
      this.processedResults = []

      // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –ø–µ—Ä–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
      this.service1.onEventProcessed = (result) => {
        this.handleProcessedEvent(result)
      }
    }

    handleProcessedEvent(result) {
      console.log(`üì® –ü–æ–ª—É—á–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${result.eventData.name}`)
      this.processedResults.push(result)
    }
  }

  describe("–ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É –æ–±—Ä–∞–±–æ—Ç–∫–∏", () => {
    let service1, service2

    beforeEach(() => {
      service1 = new MockService1()
      service2 = new MockService2(service1)
    })

    test("–¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ñ–ª–æ—É", async () => {
      // Arrange - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
      const eventData = { name: "test-event", data: "test-data" }

      // Act - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
      const result = await service1.processEvent(eventData)

      // Assert - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      expect(result.processed).toBe(true)
      expect(service2.processedResults).toHaveLength(1)
      expect(service2.processedResults[0].eventData).toEqual(eventData)
    })
  })
})
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–Ω—Ü–∏–ø—ã

1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –∏—Å–ø–æ–ª—å–∑—É–µ–º JavaScript –≤–º–µ—Å—Ç–æ TypeScript –¥–ª—è —Ç–µ—Å—Ç–æ–≤
2. **–ò–∑–æ–ª—è—Ü–∏—è** - –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º –æ—Ç –¥—Ä—É–≥–∏—Ö
3. **–ú–æ–∫–∏** - –ø—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –º–æ–∫–æ–≤
4. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** - –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ –∏ –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

```
src/__tests__/
‚îú‚îÄ‚îÄ unit/                    # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/            # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CaptchaService.test.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AntiSpamService.test.js
‚îÇ   ‚îî‚îÄ‚îÄ core/                # –¢–µ—Å—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ integration/             # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ AntiSpamFlow.test.js # –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É –∞–Ω—Ç–∏—Å–ø–∞–º–∞
‚îÇ   ‚îî‚îÄ‚îÄ CaptchaFlow.test.js  # –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É –∫–∞–ø—á–∏
‚îú‚îÄ‚îÄ setup.ts                 # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤
‚îî‚îÄ‚îÄ README.md                # –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –ü–ª–∞–Ω—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

**–ë–ª–∏–∂–∞–π—à–∏–µ —Ü–µ–ª–∏**:
- [ ] Container.test.js - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- [ ] Config.test.js - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [ ] Database.test.js - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- [ ] Redis.test.js - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞

**–ë—É–¥—É—â–∏–µ –ø–ª–∞–Ω—ã**:
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è TelegramBot + CaptchaService
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ñ–ª–æ—É –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- [ ] E2E —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º Telegram API
- [ ] Performance —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤
- [ ] –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

### –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

```
Test Suites: 2 passed, 2 total
Tests:       19 passed, 19 total
Time:        ~2.8s
Coverage:    AntiSpam Flow ‚úÖ + Captcha Flow ‚úÖ
```

### –¶–µ–ª–∏ –ø–æ–∫—Ä—ã—Ç–∏—è

- **Statements**: > 80%
- **Branches**: > 75%
- **Functions**: > 85%
- **Lines**: > 80%

### –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–∞

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
npm run test:coverage

# –ü—Ä–æ—Å–º–æ—Ç—Ä HTML –æ—Ç—á–µ—Ç–∞
open coverage/lcov-report/index.html
```

## üîß –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
npm test -- --testNamePattern="–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç"

# Verbose —Ä–µ–∂–∏–º –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
npm test -- --verbose

# –ó–∞–ø—É—Å–∫ —Å –¥–µ—Ç–µ–∫—Ç–æ—Ä–æ–º –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ö–µ–Ω–¥–ª–æ–≤
npm test -- --detectOpenHandles
```

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞**: Jest –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —Ç–µ—Å—Ç—ã
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `testMatch` –≤ `jest.config.js`

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–∞–π–º–∞—É—Ç—ã —Ç–µ—Å—Ç–æ–≤
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `jest.setTimeout(10000)` –≤ —Ç–µ—Å—Ç–µ

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–æ–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω—ã—Ö –º–æ–∫–æ–≤

## üéØ Best Practices

### DO ‚úÖ

- –ü–∏—à–∏—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ AAA pattern (Arrange, Act, Assert)
- –î–µ–ª–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—ã–µ –º–æ–∫–∏

### DON'T ‚ùå

- –ù–µ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- –ù–µ –¥–µ–ª–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–∏—Å–∏–º—ã–º–∏ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ API –≤ —Ç–µ—Å—Ç–∞—Ö
- –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ—á–∏—â–∞—Ç—å –º–æ–∫–∏ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤
- –ù–µ –ø–∏—à–∏—Ç–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã–µ —Ç–µ—Å—Ç—ã

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **[Jest Documentation](https://jestjs.io/docs/getting-started)** - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **[Testing Best Practices](https://github.com/goldbergyoni/javascript-testing-best-practices)** - –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
- **[–û—Å–Ω–æ–≤–Ω–æ–π README](../src/__tests__/README.md)** - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∞–º

---

> üí° **–°–æ–≤–µ—Ç**: –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ—Å—Ç–æ–≤ –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å. –•–æ—Ä–æ—à–∏–µ —Ç–µ—Å—Ç—ã - —ç—Ç–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞!
