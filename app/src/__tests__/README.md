# üß™ –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∑–∞–ø—É—Å–∫—É —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è Telegram –±–æ—Ç–∞.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ç–µ—Å—Ç–æ–≤)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- [–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤](#–∑–∞–ø—É—Å–∫-—Ç–µ—Å—Ç–æ–≤)
- [–ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤](#–Ω–∞–ø–∏—Å–∞–Ω–∏–µ-—Ç–µ—Å—Ç–æ–≤)
- [–ú–æ–∫–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã](#–º–æ–∫–∏-–∏-—É—Ç–∏–ª–∏—Ç—ã)
- [–ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤](#–ø—Ä–∏–º–µ—Ä—ã-—Ç–µ—Å—Ç–æ–≤)

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
src/__tests__/
‚îú‚îÄ‚îÄ setup.ts                     # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ unit/                        # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ core/                    # –¢–µ—Å—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Container.test.ts    # –¢–µ—Å—Ç—ã DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ services/                # –¢–µ—Å—Ç—ã –±–∏–∑–Ω–µ—Å-—Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CaptchaService.test.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AntiSpamService.test.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AIChatService.test.ts
‚îÇ   ‚îî‚îÄ‚îÄ config.test.ts           # –¢–µ—Å—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ README.md                    # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
npm install --save-dev jest @types/jest ts-jest
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–¢–µ—Å—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —á–µ—Ä–µ–∑ `jest.config.js` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

- **TypeScript**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ES –º–æ–¥—É–ª–µ–π —á–µ—Ä–µ–∑ `ts-jest`
- **Test environment**: Node.js
- **Coverage**: –í–∫–ª—é—á–µ–Ω —Å–±–æ—Ä –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞
- **Setup**: –ì–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ `setup.ts`

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
npm test

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ —Ä–µ–∂–∏–º–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
npm run test:watch

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
npm run test:coverage

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è CI/CD
npm run test:ci
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
npm test Container.test.ts

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º
npm test -- --testNamePattern="Captcha"

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–ø–∫–µ
npm test src/__tests__/unit/services/
```

## ‚úçÔ∏è –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

### –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞

```typescript
import { beforeEach, describe, expect, test } from "jest"

describe("–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞", () => {
  let service: MyService

  beforeEach(() => {
    service = new MyService()
  })

  describe("–ì—Ä—É–ø–ø–∞ —Ç–µ—Å—Ç–æ–≤", () => {
    test("–¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ", () => {
      // Arrange - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
      const input = "test input"

      // Act - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
      const result = service.processInput(input)

      // Assert - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      expect(result).toBe("expected output")
    })
  })
})
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

1. **AAA Pattern**: Arrange, Act, Assert
2. **–û–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤
3. **–û–¥–∏–Ω —Ç–µ—Å—Ç - –æ–¥–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–¥–Ω—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
4. **–ò–∑–æ–ª—è—Ü–∏—è**: –¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞

## üé≠ –ú–æ–∫–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã

–í —Ñ–∞–π–ª–µ `setup.ts` –¥–æ—Å—Ç—É–ø–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã:

```typescript
// –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
global.testUtils.mockTime(Date.now())
global.testUtils.restoreTime()

// –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–µ–π–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
const fakeUser = global.testUtils.createFakeUser(123456)
const fakeChat = global.testUtils.createFakeChat(-1001234567890)
const fakeMessage = global.testUtils.createFakeMessage("Hello")

// –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ
await global.testUtils.sleep(100)
```

### –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```typescript
import { jest } from "@jest/globals"

// –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è
jest.mock("../../../services/AIService/index.js", () => ({
  AIService: jest.fn().mockImplementation(() => ({
    processMessage: jest.fn().mockResolvedValue("AI response"),
  })),
}))

// –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
const mockFunction = jest.fn()
mockFunction.mockReturnValue("mocked value")
mockFunction.mockResolvedValue("async mocked value")
```

### –†–∞–±–æ—Ç–∞ —Å —Ç–∞–π–º–µ—Ä–∞–º–∏

```typescript
// –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–π–º–µ—Ä–æ–≤
jest.useFakeTimers()

// –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
jest.advanceTimersByTime(60000) // 60 —Å–µ–∫—É–Ω–¥

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–∞–π–º–µ—Ä–æ–≤
jest.useRealTimers()
```

## üìù –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

```typescript
it("–¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏", async () => {
  const service = new AsyncService()

  const result = await service.asyncMethod()

  expect(result).toBe("expected result")
})
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

```typescript
it("–¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –æ—à–∏–±–∫—É –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö", () => {
  const service = new Service()

  expect(() => {
    service.processInvalidData(null)
  }).toThrow("Invalid data provided")
})

it("–¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏", async () => {
  const service = new AsyncService()

  await expect(service.failingMethod()).rejects.toThrow("Async error")
})
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–±—ç–∫–æ–≤

```typescript
it("–¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å –∫–æ–ª–±—ç–∫ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏", () => {
  const service = new CallbackService()
  const callback = jest.fn()

  service.processWithCallback("data", callback)

  expect(callback).toHaveBeenCalledWith("processed data")
  expect(callback).toHaveBeenCalledTimes(1)
})
```

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

1. **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É**: –û—Å–Ω–æ–≤–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∏ –ø—Ä–∞–≤–∏–ª–∞
2. **–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏**: –ö—Ä–∞–π–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏**: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –ß—Ç–æ –ù–ï —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

1. **–í–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**: Jest, axios, –∏ —Ç.–¥.
2. **–¢—Ä–∏–≤–∏–∞–ª—å–Ω—ã–µ –≥–µ—Ç—Ç–µ—Ä—ã/—Å–µ—Ç—Ç–µ—Ä—ã**: –ü—Ä–æ—Å—Ç—ã–µ accessor –º–µ—Ç–æ–¥—ã
3. **–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã**: –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π API

### –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

–°—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –ø–æ–∫—Ä—ã—Ç–∏—é:
- **Statements**: > 80%
- **Branches**: > 75%
- **Functions**: > 85%
- **Lines**: > 80%

## üîß –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö

```typescript
it("–æ—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ç–µ—Å—Ç", () => {
  const result = service.method()

  // –í—Ä–µ–º–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  console.log("Debug result:", result)

  expect(result).toBeDefined()
})
```

### –ó–∞–ø—É—Å–∫ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

```bash
# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ .only)
test.only('—Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç —Ç–µ—Å—Ç –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω', () => {
  // ...
});

# –ü—Ä–æ–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
test.skip('—ç—Ç–æ—Ç —Ç–µ—Å—Ç –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω', () => {
  // ...
});
```

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º—ã —Å ES –º–æ–¥—É–ª—è–º–∏

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏:

```typescript
// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .js —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤ –∏–º–ø–æ—Ä—Ç–∞—Ö
import { Service } from "../../../services/Service/index.js"
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–π–º–µ—Ä–∞–º–∏

```typescript
// –í—Å–µ–≥–¥–∞ –æ—á–∏—â–∞–π—Ç–µ —Ç–∞–π–º–µ—Ä—ã –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤
afterEach(() => {
  jest.useRealTimers()
  jest.clearAllTimers()
})
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å—é

```typescript
// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ async/await –∏–ª–∏ return Promise
it("async test", async () => {
  await expect(asyncOperation()).resolves.toBe("result")
})
```

---

> üí° **–°–æ–≤–µ—Ç**: –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ—Å—Ç–æ–≤ –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å. –•–æ—Ä–æ—à–∏–µ —Ç–µ—Å—Ç—ã - —ç—Ç–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≤–∞—à–µ–≥–æ –∫–æ–¥–∞!
