# Примечание: идемпотентность и outbox (на будущее)

— Если начнут приходить дубли апдейтов от Telegram, добавить простую идемпотентность на входе (Redis SET NX EX по update_id или chat_id:message_id).

— Если появится риск потери/дублирования исходящих действий (sendMessage/ban и т.п.), внедрить outbox-таблицу и фонового воркера с ретраями и backoff (учитывать retry_after).

— Для внешних сервисов при всплесках ошибок обернуть вызовы тайм-аутами, экспоненциальным backoff с джиттером и простым circuit breaker.

— При необходимости «ровно один раз» семантики для исходящих эффектов — прокинуть dedupKey в AI/капчу/модерацию.

— При внедрении этих механизмов — обновить env.example и кратко задокументировать в docs.


